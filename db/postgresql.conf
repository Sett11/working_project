# Оптимизированные настройки PostgreSQL для контейнера с ограниченными ресурсами

# Память
shared_buffers = 64MB                    # 25% от доступной памяти (256MB)
effective_cache_size = 128MB             # 50% от доступной памяти
maintenance_work_mem = 16MB              # Для операций обслуживания
work_mem = 4MB                           # Для операций сортировки и хеширования

# WAL (Write-Ahead Logging)
wal_buffers = 4MB                        # Буферы WAL
checkpoint_completion_target = 0.9       # Целевое время завершения checkpoint
checkpoint_timeout = 15min               # Интервал checkpoint

# Статистика и планировщик
default_statistics_target = 100          # Статистика для планировщика
random_page_cost = 1.1                   # Стоимость случайного доступа
effective_io_concurrency = 200           # Параллельный I/O

# Сетевые настройки
listen_addresses = '*'                   # Слушать все интерфейсы
port = 5432                             # Стандартный порт PostgreSQL

# Соединения
max_connections = 20                     # Ограниченное количество соединений для контейнера
superuser_reserved_connections = 3       # Резервные соединения для суперпользователя

# Логирование (только ERROR для экономии ресурсов)
log_min_messages = error                 # Логировать только ERROR и выше
log_min_error_statement = error          # Логировать только ERROR statements
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = off
log_connections = off
log_disconnections = off
log_lock_waits = off
log_temp_files = -1
log_min_duration_statement = -1          # Отключить логирование медленных запросов
log_statement = 'none'                   # Не логировать SQL statements
log_duration = off                       # Не логировать длительность запросов

# Автовакуум (оптимизированный)
autovacuum = on
autovacuum_max_workers = 1               # Один воркер для экономии ресурсов
autovacuum_naptime = 1min                # Интервал проверки
autovacuum_vacuum_threshold = 50         # Порог для vacuum
autovacuum_analyze_threshold = 50        # Порог для analyze
autovacuum_vacuum_scale_factor = 0.1     # Фактор масштаба для vacuum
autovacuum_analyze_scale_factor = 0.05   # Фактор масштаба для analyze

# Производительность
synchronous_commit = off                 # Отключить синхронный commit для производительности
fsync = on                               # Но включить fsync для надежности
full_page_writes = on                    # Полные страницы в WAL

# Локализация
lc_messages = 'C'
lc_monetary = 'C'
lc_numeric = 'C'
lc_time = 'C'
default_text_search_config = 'pg_catalog.english'
